<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <title>User Profile</title>

</head>

<body>
    <nav class="navibar">
        <span class="menu-toggle"><i class="fa-solid fa-bars"></i></span>
        <ul class="navi">
            <li><a href="/home">HOME</a></li>
            <li><a href="/profile">PROFILE</a></li>
            <li><a href="/chat">CHAT</a></li>
            <li>
                <a href="{{ url_for('friends_page') }}" id="friends-link">
                    FRIENDS
                    {% if pending_req_count > 0 %}
                    <span class="dot"></span>
                    {% endif %}
                </a>
            </li>
            <li><a href="/logout">LOGOUT</a></li>

        </ul>
        {% if user %}
        <div class="welcome">Welcome {{ user.name }} !!</div>
        {% endif %}
    </nav><br><br>

    <center>
        <h2>Edit Your Profile Here!</h2>
    </center>

    <table>
        <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Gender</th>
            <th>Action</th>
        </tr>
        <tr>
            <td>{{ user.name }}</td>
            <td>{{ user.email }}</td>
            <td>{{ user.phone_number }}</td>
            <td>{{ user.gender }}</td>
            <td>
                <form action="/edit" method="post" style="display:inline;">
                    <button type="submit" class="btn edit">Edit Profile</button>
                </form>

                <form action="/add_content" method="get" style="display:inline;">
                    <input type="hidden" name="email" value="{{ user.email }}">
                    <input type="hidden" name="name" value="{{ user.name }}">
                    <button type="submit" class="btn add">Add Content to Display on Home Page</button>
                </form>

                <form action="/delete" method="POST" style="display:inline;"
                    onsubmit="return confirm('Are you sure you want to DELETE your profile permanently?');">
                    <button type="submit" class="btn delete">Delete Profile</button>
                </form>
            </td>
        </tr>
    </table>
    <center>
        <p>{{ msg }}</p>
    </center>

    <center>
        <h3 class="topic_title" style="display:none;">Your Uploaded Content</h3>
    </center>

    <div class="container">
        {% for c in content %}
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>{{ c.name }}</h3>
                <h4 style="font-size:12px; color:rgb(0, 0, 0); margin-right:10px;">
                    Uploaded at: {{ c.uploaded_at }}
                </h4>

                <form action="/del" method="POST" style="display:inline;"
                    onsubmit="return confirm('Are you sure you want to DELETE this record permanently from database?');">
                    <input type="hidden" name="content_id" value="{{ c.thought }}">
                    <button type="submit" style="width:40px; height:25px;" class="btn delete">Del</button>
                </form>
            </div><br>

            {% if c.media_type == "image" %}
            <img src="data:image/*;base64,{{ c.filedata }}" alt="User Image">

            {% elif c.media_type == "video" %}
            <video width="100%" height="120px;" controls>
                <source src="data:video/mp4;base64,{{ c.filedata }}" type="video/mp4">
            </video>

            {% elif c.media_type in ["pdf", "doc", "ppt", "txt"] %}
            <p>
                <a href="data:application/{{ c.media_type }};base64,{{ c.filedata }}"
                    download="document.{{ c.media_type }}"><br><br><br>
                    DOWNLOAD THIS FILE
                </a>

            </p><br>
            {% endif %}

            <p>{{ c.thought }}</p>
        </div>
        {% endfor %}
    </div>
    <script>
        const params = new URLSearchParams(window.location.search);
        const msg = params.get("msg");
        if (msg) {
            alert(msg);
        }
    </script>
    <script>
        function validate() {
            const file_input = document.querySelectorAll(".card")
            const topic = document.querySelectorAll(".topic_title");
            const file_count = file_input.length;

            if (file_count != 0) {
                topic.style.display = "block";
            }
            else {
                topic.style.display = "none";
            }
        }
        validate();
    </script>


    <script>
        const menuToggle = document.querySelector(".menu-toggle");
        const navMenu = document.querySelector(".navi");

        menuToggle.addEventListener("click", () => {
            navMenu.classList.toggle("show");
        });

        document.querySelectorAll(".navi a").forEach(link => {
            link.addEventListener("click", () => {
                navMenu.classList.remove("show");
            });
        });
    </script>
</body>

</html>